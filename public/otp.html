<!doctype html>
<html lang="fa">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>تایید OTP - XZ</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div style="display:flex;align-items:center;justify-content:center;height:100vh;">
  <div class="panel" style="width:360px">
    <h3>کد تایید را وارد کنید</h3>
    <input id="otp" placeholder="کد ۴ رقمی" maxlength="4" style="width:100%;padding:10px;border-radius:8px">
    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="verify" class="action-btn">تایید و ادامه</button>
      <a href="signup.html"><button class="action-btn" style="background:#ccc;color:#000">بازگشت</button></a>
    </div>
    <p id="msg"></p>
  </div>
</div>
<script>
const url = new URL(location.href);
const phone = url.searchParams.get('phone') || localStorage.getItem('pendingPhone') || '';
document.getElementById("verify").addEventListener("click", async ()=>{
  const otp = document.getElementById("otp").value.trim();
  if(!otp || otp.length!==4){document.getElementById("msg").innerText="کد ۴ رقمی وارد کنید";return;}
  const res = await fetch("/api/verify-otp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone,otp})});
  const data = await res.json();
  if(data.success){
    alert("ثبت‌نام با موفقیت انجام شد. حالا وارد شوید.");
    window.location.href = "login.html";
  } else {
    document.getElementById("msg").innerText = data.message || "خطا";
  }
});
</script>
</body>
</html>
