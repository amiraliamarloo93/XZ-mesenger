<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>پروفایل — XZ</title><link rel="stylesheet" href="css/style.css"></head>
<body>
  <div class="auth-root">
    <div class="card">
      <h2>پروفایل</h2>
      <input id="firstName" placeholder="نام">
      <input id="lastName" placeholder="نام خانوادگی">
      <input id="pin" placeholder="رمز ۴ رقمی" maxlength="4" type="password">
      <button id="saveBtn">ذخیره</button>
      <p class="muted"><a href="groups.html">بازگشت</a></p>
    </div>
  </div>
<script>
  const u = JSON.parse(localStorage.getItem('user')||'null');
  if(!u) location.href='login.html';
  document.getElementById('firstName').value = u.firstName || '';
  document.getElementById('lastName').value = u.lastName || '';
  document.getElementById('saveBtn').onclick = async ()=> {
    const firstName = document.getElementById('firstName').value.trim();
    const lastName = document.getElementById('lastName').value.trim();
    const pin = document.getElementById('pin').value.trim();
    // call server to update
    const res = await fetch('/update-profile',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({ phone:u.phone, firstName, lastName, pin })});
    const data = await res.json();
    if(data.success){
      alert('به‌روزرسانی شد');
      localStorage.setItem('user', JSON.stringify({ phone:u.phone, firstName, lastName }));
    } else alert('خطا');
  };
</script>
</body>
</html>
