<!doctype html>
<html lang="fa">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ - XZ</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app-shell">
  <div class="sidebar">
    <div class="brand">
      <div class="logo">XZ</div>
      <div>
        <h1>Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† XZ</h1>
        <small style="color:rgba(255,255,255,0.6)">Ø³Ù„Ø§Ù…ØŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</small>
      </div>
    </div>
    <input class="search" id="search" placeholder="ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ú©Ø§Ù†Ø§Ù„/Ù…Ø®Ø§Ø·Ø¨..." style="margin-top:8px">
    <div class="chat-list" id="list"></div>
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="btnNewGroup" class="action-btn">Ø³Ø§Ø®Øª Ú¯Ø±ÙˆÙ‡</button>
      <button id="btnNewChannel" class="action-btn">Ø³Ø§Ø®Øª Ú©Ø§Ù†Ø§Ù„</button>
    </div>
    <div style="margin-top:14px">
      <button onclick="location.href='profile.html'" class="action-btn" style="background:#444">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</button>
      <button onclick="location.href='settings.html'" class="action-btn" style="background:#666">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
      <button id="logout" class="action-btn" style="background:#c33">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <div class="chat-area">
    <div class="chat-header">
      <div class="title">ÛŒÚ© Ú¯ÙØªÚ¯Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</div>
      <div><small id="userLabel"></small></div>
    </div>
    <div class="chat-main" id="mainArea">
      <div class="message received">Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ ÛŒÚ© Ú¯Ø±ÙˆÙ‡ ÛŒØ§ Ú©Ø§Ù†Ø§Ù„ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†.</div>
    </div>
    <div style="display:flex;gap:8px;align-items:center;padding-top:10px;">
      <input id="msgBox" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." style="flex:1;padding:10px;border-radius:8px">
      <input type="file" id="fileInput" style="display:none">
      <label for="fileInput" class="action-btn" style="background:#888;cursor:pointer">ğŸ“</label>
      <button id="sendBtn" class="action-btn">Ø§Ø±Ø³Ø§Ù„</button>
    </div>
  </div>
</div>

<script>
const phone = localStorage.getItem("phone");
const user = JSON.parse(localStorage.getItem("user") || "null");
if(!user){ location.href = "login.html"; }

document.getElementById("userLabel").innerText = user.firstName || user.phone;

async function loadGroups(q=""){
  const res = await fetch("/api/groups");
  const data = await res.json();
  const list = document.getElementById("list");
  list.innerHTML = "";
  for(const id in data){
    const g = data[id];
    if(q && !(g.name+ " " + g.description).toLowerCase().includes(q.toLowerCase())) continue;
    const el = document.createElement("div");
    el.className = "chat-item";
    el.innerHTML = `<div class="meta"><strong>${g.name}</strong><small>${g.description || ''}</small></div>
                    <div style="text-align:center"><small>${g.members} Ø¹Ø¶Ùˆ</small></div>`;
    el.onclick = () => { localStorage.setItem("currentGroup", id); location.href = "chat.html"; };
    list.appendChild(el);
  }
}
loadGroups();

document.getElementById("search").addEventListener("input", (e)=> loadGroups(e.target.value));
document.getElementById("logout").addEventListener("click", ()=>{ localStorage.removeItem("user"); localStorage.removeItem("phone"); location.href="index.html"; });

document.getElementById("btnNewGroup").addEventListener("click", async ()=>{
  const name = prompt("Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡:");
  if(!name) return;
  const res = await fetch("/api/create-group",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name,description:"",creator:phone})});
  const d = await res.json();
  if(d.success){ alert("Ú¯Ø±ÙˆÙ‡ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯"); loadGroups(); } else alert(d.message || "Ø®Ø·Ø§");
});

document.getElementById("btnNewChannel").addEventListener("click", async ()=>{
  const name = prompt("Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„:");
  if(!name) return;
  const res = await fetch("/api/create-group",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name,description:"Ú©Ø§Ù†Ø§Ù„",creator:phone})});
  const d = await res.json();
  if(d.success){ alert("Ú©Ø§Ù†Ø§Ù„ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯"); loadGroups(); } else alert(d.message || "Ø®Ø·Ø§");
});

</script>
</body>
</html>
